# Snakemake rules to generate reference sequence data
#
# Author: Maurits Evers
# License: GPLv3
# Original date: 14-10-2016
# Last changed: 23-10-2016

localrules:
    download_ref_from_Ensembl

# Download reference sequence from Ensembl
rule download_ref_from_Ensembl:
    input:
        "scripts/downloadFastaFromEnsembl.sh"
    output:
        REF
    params:
        cmd    = "scripts/downloadFastaFromEnsembl.sh",
        mask   = config["refseq"]["mask"],
        genome = config["refseq"]["id"],
        refdir = config["refdir"]
    version: "1.0"
    shell:
        """
            {params.cmd} {params.genome} {params.mask} {params.refdir}
        """


# Make bowtie2 index
rule make_bowtie2_index:
    input:
        REF
    output:
        IDX
    log:
        expand("logs/bowtie2-build_{id}.log", id = config["refseq"]["id"])
    params:
        cmd  = "bowtie2-build",
        base = re.sub(".fa", "", REF)
    version: "1.0"
    shell:
        """
            {params.cmd} {input} {params.base} > {log}
        """
